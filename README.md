# avitotechBackendPR

Сервис автоматического назначения и переназначения ревьюверов для Pull Request-ов.  
Реализован в соответствии с предоставленной OpenAPI-спецификацией (`openapi.yml`).

## Стек

- Go 1.25
- PostgreSQL 18
- pgx + squirrel
- chi router
- slog
- golangci-lint

## Старт

### Запуск в Docker

```bash
make run
```

Запускаются:

- сервис — `http://localhost:8080`
- PostgreSQL — `localhost:5432`

**Миграции применяются автоматически**  
Флаг `-tags migrate` включает файл `migrate.go`, который автоматически применяет все миграции из `migrations` при
старте сервиса.

### Остановка

```bash
make down
```

### Другие make-команды

| Команда            | Описание                                          |
|--------------------|---------------------------------------------------|
| `make run`         | сборка и запуск сервиса + БД                      |
| `make stop`        | остановка контейнеров                             |
| `make down`        | остановка и удаление контейнеров                  |
| `make down-volume` | остановка и удаление контейнеров вместе с данными |
| `make e2e-test`    | запуск набора E2E-тестов                          |
| `make load-test`   | запуск нагрузочных тестов                         |
| `make lint`        | запуск golangci-lint                              |
| `make lint-fix`    | автофикс простых проблем линтером                 |

## Тестирование

### E2E-тесты

```bash
make e2e-test
```

### Нагрузочное тестирование

Для нагрузочного тестирования используется [k6](https://k6.io/).

#### Запуск нагрузочного тестирования

```bash
make load-test
```

Данная команда:

1. Поднимает изолированное окружение с тестовой БД
2. Запускает сервис с тестовой конфигурацией (`.env.test`)
3. Выполняет нагрузочные тесты
4. Автоматически очищает окружение после завершения

Во время выполнения теста доступен **веб-дашборд k6** для мониторинга метрик в реальном времени:

```
web dashboard: http://127.0.0.1:5665
```

#### Результаты тестирования

После выполнения нагрузочного тестирования генерируются следующие отчеты:

- `tests/load/results/results.json` - детальные результаты в JSON формате
- `tests/load/results/summary.json` - сводная статистика
- `tests/load/results/report.html` - отчет в формате HTML

Отчёт об проведенном тестировании находится в файле - [`report.html`](./tests/load/results/report.html)

## Архитектура

Проект построен по принципам **чистой архитектуры**:

1. **domain** — доменные модели, ошибки, типы ответов
2. **usecase** — бизнес-логика
3. **adapter/postgres** — реализация репозиториев (pgx + squirrel)
4. **controller/http** — HTTP-слой
5. **pkg** — переиспользуемая инфраструктура (httpserver, postgres, logger)

## Логирование

- Используется стандартный пакет `log/slog` с JSON-выводом.
- Уровень логирования задаётся через переменную `LOG_LEVEL` в `.env`.
- Источник ошибки (файл и строка) указывается автоматически.

## Конфигурация линтера

- Файл: `.golangci.yml`
- Настроен workflow

## Принятые допущения

- Файл `.env` включён в репозиторий только по требованию задания. В реальных проектах он должен быть в `.gitignore`.
- Все ошибки возвращаются с кодами из OpenAPI-спецификации.